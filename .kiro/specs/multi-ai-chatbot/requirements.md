# Requirements: multi-ai-chatbot

## Project Description

差別化AIチャットボット - 複数AIモデル（GPT-4/Claude/Gemini）切り替え、会話履歴保存・エクスポート、プロンプトテンプレート機能を持つポートフォリオ用チャットアプリ。日本語/英語UI（i18n）、ダークモード対応。Next.js + Vercel AI SDK + shadcn/ui で構築。

## Target & Goals

- **ターゲット**: ポートフォリオ用（仕事受注のための差別化）
- **技術スタック**: Next.js 15, Tailwind CSS, shadcn/ui, Vercel AI SDK
- **対応AIモデル**:
  - デフォルト（コスト効率）: GPT-4o-mini, Claude 3.5 Sonnet, Gemini 2.0 Flash
  - プレミアム（最新）: GPT-5.2, Claude Opus 4.5, Gemini 3 Pro

---

## Requirements

### FR-1: AIモデル選択・切り替え

**FR-1.1**: システムは、ユーザーがチャット画面上でAIモデル（GPT/Claude/Gemini）を選択できるUIを提供しなければならない。

**FR-1.2**: ユーザーがAIモデルを変更したとき、システムは次のメッセージから選択されたモデルを使用しなければならない。

**FR-1.3**: システムは、各AIプロバイダーについてデフォルトモデル（コスト効率優先）とプレミアムモデル（最新）の2種類を提供しなければならない。

**FR-1.4**: システムは、現在選択中のAIモデル名をチャットUI上に常に表示しなければならない。

**FR-1.5**: APIキーが設定されていないプロバイダーについて、システムは当該モデルを選択不可として表示しなければならない。

---

### FR-2: チャット機能

**FR-2.1**: システムは、ユーザーがテキストメッセージを入力し、選択されたAIモデルに送信できる入力フォームを提供しなければならない。

**FR-2.2**: ユーザーがメッセージを送信したとき、システムはAIからのレスポンスをストリーミング形式でリアルタイムに表示しなければならない。

**FR-2.3**: システムは、ユーザーメッセージとAIレスポンスを視覚的に区別できる形式で表示しなければならない。

**FR-2.4**: AIがレスポンスを生成中の間、システムはローディングインジケーターを表示しなければならない。

**FR-2.5**: ユーザーがEnterキーを押したとき、システムはメッセージを送信しなければならない。Shift+Enterを押したとき、システムは改行を挿入しなければならない。

**FR-2.6**: システムは、各メッセージに送信日時を表示しなければならない。

**FR-2.7**: AIエラーが発生した場合、システムはユーザーフレンドリーなエラーメッセージを現在の言語設定（日本語/英語）で表示しなければならない。

---

### FR-3: 会話履歴管理

**FR-3.1**: システムは、会話をセッション（会話スレッド）単位で管理し、サイドバーに一覧表示しなければならない。

**FR-3.2**: ユーザーが「新規チャット」ボタンをクリックしたとき、システムは新しい会話セッションを作成しなければならない。

**FR-3.3**: ユーザーがサイドバーの会話を選択したとき、システムは当該会話の履歴を読み込んで表示しなければならない。

**FR-3.4**: システムは、会話履歴をブラウザのローカルストレージに自動保存しなければならない。

**FR-3.5**: ユーザーが会話を削除したとき、システムは現在の言語設定に応じた確認ダイアログを表示し、確認後に当該会話をローカルストレージから削除しなければならない。

**FR-3.6**: システムは、各会話に対してタイトル（最初のメッセージの要約または先頭30文字）を自動設定しなければならない。

**FR-3.7**: ユーザーが会話タイトルを編集したとき、システムは新しいタイトルを保存しなければならない。

---

### FR-4: エクスポート機能

**FR-4.1**: システムは、現在の会話をテキスト形式（.txt）でエクスポートする機能を提供しなければならない。

**FR-4.2**: システムは、現在の会話をMarkdown形式（.md）でエクスポートする機能を提供しなければならない。

**FR-4.3**: システムは、現在の会話をPDF形式でエクスポートする機能を提供しなければならない。

**FR-4.4**: エクスポートされたファイルには、会話タイトル、日時、使用AIモデル、全メッセージ内容が含まれなければならない。

**FR-4.5**: ユーザーがエクスポートボタンをクリックしたとき、システムはエクスポート形式を選択するメニューを表示しなければならない。

---

### FR-5: プロンプトテンプレート

**FR-5.1**: システムは、プリセットのプロンプトテンプレートを日本語と英語の両方で提供しなければならない（例: コードレビュー依頼、文章校正、翻訳、要約）。

**FR-5.2**: ユーザーがテンプレートを選択したとき、システムは現在の言語設定に応じたテンプレートテキストを入力フォームに挿入しなければならない。

**FR-5.3**: システムは、ユーザーがカスタムテンプレートを作成・保存できる機能を提供しなければならない。

**FR-5.4**: システムは、ユーザーがカスタムテンプレートを編集・削除できる機能を提供しなければならない。

**FR-5.5**: システムは、テンプレート一覧をカテゴリー別に整理して表示しなければならない。

**FR-5.6**: カスタムテンプレートは、ローカルストレージに永続化されなければならない。

---

### FR-6: コードブロック表示

**FR-6.1**: AIレスポンスにコードブロックが含まれる場合、システムはシンタックスハイライトを適用して表示しなければならない。

**FR-6.2**: システムは、コードブロックにコピーボタンを表示し、ワンクリックでコードをクリップボードにコピーできなければならない。

**FR-6.3**: システムは、一般的なプログラミング言語（JavaScript, TypeScript, Python, HTML, CSS, JSON, SQL, Bash等）のシンタックスハイライトをサポートしなければならない。

**FR-6.4**: コードをコピーしたとき、システムは現在の言語設定に応じたフィードバック（日本語:「コピーしました」/ 英語: "Copied!"）を表示しなければならない。

---

### FR-7: UI/UX・多言語対応

**FR-7.1**: システムは、日本語と英語の両方でUI表示をサポートしなければならない（i18n対応）。

**FR-7.2**: システムは、ヘッダーに言語切り替えセレクター（日本語/English）を提供しなければならない。

**FR-7.3**: ユーザーが言語を切り替えたとき、システムは全てのUI要素を選択された言語で即座に表示しなければならない。

**FR-7.4**: システムは、言語設定をローカルストレージに保存し、次回訪問時に復元しなければならない。

**FR-7.5**: システムのデフォルト言語は、ユーザーのブラウザの言語設定に従わなければならない。

**FR-7.6**: システムは、ダークモードとライトモードを切り替えられるトグルを提供しなければならない。

**FR-7.7**: ユーザーがテーマを切り替えたとき、システムは設定をローカルストレージに保存し、次回訪問時に復元しなければならない。

**FR-7.8**: システムのデフォルトテーマは、ユーザーのOSのテーマ設定に従わなければならない。

**FR-7.9**: システムは、モバイルデバイス（スマートフォン・タブレット）でも快適に操作できるレスポンシブデザインを提供しなければならない。

**FR-7.10**: モバイル表示時、サイドバーは折りたたみ可能なハンバーガーメニューとして表示されなければならない。

**FR-7.11**: システムは、shadcn/uiコンポーネントを使用した一貫性のあるデザインを提供しなければならない。

---

### FR-8: 設定機能

**FR-8.1**: システムは、各AIプロバイダーのAPIキーを設定できる設定画面を提供しなければならない。

**FR-8.2**: 設定されたAPIキーは、ブラウザのローカルストレージに暗号化して保存されなければならない。

**FR-8.3**: ユーザーがAPIキーを入力したとき、システムは当該キーの有効性を検証する機能を提供しなければならない。

**FR-8.4**: システムは、デフォルトで使用するAIモデルを設定できる機能を提供しなければならない。

---

### NFR-1: パフォーマンス

**NFR-1.1**: ユーザーがメッセージを送信したとき、システムは500ms以内にAIへのリクエストを開始しなければならない。

**NFR-1.2**: ストリーミングレスポンスの初回チャンク表示は、APIレスポンス開始から200ms以内でなければならない。

**NFR-1.3**: 1000メッセージを含む会話でも、画面スクロールは60fps以上を維持しなければならない。

**NFR-1.4**: ページの初回ロード（Largest Contentful Paint）は3秒以内でなければならない。

---

### NFR-2: セキュリティ

**NFR-2.1**: APIキーは、クライアントサイドで暗号化して保存されなければならない。

**NFR-2.2**: APIキーは、UI上でマスク表示（********）されなければならない。

**NFR-2.3**: システムは、AIへのリクエストにおいてユーザー入力をサニタイズし、プロンプトインジェクション攻撃を緩和しなければならない。

**NFR-2.4**: システムは、HTTPSを使用して全ての通信を暗号化しなければならない。

---

### NFR-3: アクセシビリティ

**NFR-3.1**: システムは、キーボードのみで全ての主要機能を操作できなければならない。

**NFR-3.2**: システムは、スクリーンリーダーで正しく読み上げられるよう、適切なARIA属性を設定しなければならない。

**NFR-3.3**: システムは、WCAG 2.1 Level AAのコントラスト比要件を満たさなければならない。

---

### NFR-4: 互換性

**NFR-4.1**: システムは、主要なモダンブラウザ（Chrome, Firefox, Safari, Edge の最新2バージョン）で動作しなければならない。

**NFR-4.2**: システムは、iOS Safari および Android Chrome で動作しなければならない。

---

## Acceptance Criteria Summary

| 要件ID | 受け入れ条件 |
|--------|-------------|
| FR-1 | AIモデルを切り替えて、異なるプロバイダーのレスポンスを取得できる |
| FR-2 | メッセージを送信し、ストリーミングでAIレスポンスを受信できる |
| FR-3 | 会話履歴が保存され、ブラウザを閉じても復元される |
| FR-4 | 会話をテキスト/Markdown/PDF形式でダウンロードできる |
| FR-5 | プリセットおよびカスタムテンプレートを使用できる |
| FR-6 | コードブロックがシンタックスハイライト付きで表示される |
| FR-7 | 日本語/英語UIで言語・テーマ（ダーク/ライト）が切り替えられる |
| FR-8 | APIキーを設定し、設定が永続化される |
| NFR-1 | レスポンスタイムが規定値以内である |
| NFR-2 | APIキーが暗号化保存され、マスク表示される |
| NFR-3 | キーボード操作とスクリーンリーダーで操作可能 |
| NFR-4 | 主要ブラウザで動作確認済み |

---

*Generated: 2025-12-17*
*Format: EARS (Easy Approach to Requirements Syntax)*
